package mop;

import java.io.*;

/**
 * Prevents invocations of mark() if the Reader does not support.
 *
 * Some subclasses of Reader do not support mark() and reset().
 * http://download.oracle.com/javase/6/docs/api/java/io/Reader.html#mark%28int%29
 *
 * PushbackReader, InputStreamReader, FileReader and PipedReader do not
 * support mark() and reset(). This specification warns if mark() or reset()
 * is invoked.
 *
 * @severity error
 */

Reader_MarkReset(Reader r) {
	event mark before(Reader+ r) : 
		call(* Reader+.mark(..)) && target(r) 
		&& if(r instanceof PushbackReader 
		   || r instanceof InputStreamReader
		   || r instanceof FileReader
		   || r instanceof PipedReader) {}
	event reset before(Reader+ r) : 
		call(* Reader+.reset(..)) && target(r)
		&& if(r instanceof PushbackReader 
		   || r instanceof InputStreamReader
		   || r instanceof FileReader
		   || r instanceof PipedReader) {}

	ere: mark | reset

	@match {
		System.err.println("PushbackReader, InputStreamReader, FileReader and PipedReader do not support mark() and reset().");
	}
}
